# Ultimate Chicken Horse - 使用說明

## 已完成的更新

### 1. 修正 ERASER 功能
- ✅ ERASER 現在可以正確清除範圍內的多個物件
- ✅ 清除範圍為圓形（半徑 = max(寬度, 高度) / 2）
- ✅ ERASER 本身不會顯示方塊

### 2. 所有物件都有實體
- ✅ 死亡平台（紅色）現在可以站立
- ✅ 死亡平台仍然會檢測碰觸並導致失敗
- ✅ 所有平台類型都具有碰撞體積

### 3. 移除隨機平台功能
- ✅ 遊戲不再在每局自動生成隨機平台
- ✅ 平台只在遊戲開始時從配置文件加載一次

### 4. 地圖編輯器
- ✅ 創建了獨立的地圖編輯器程式 `MapEditor.java`（命令行版）
- ✅ 創建了圖形化地圖編輯器 `MapEditorGUI.java`（**推薦使用**）
- ✅ 支持**拖曳方式創建平台**，更直觀方便
- ✅ 可以自由添加、刪除、編輯平台
- ✅ 支持多種平台類型（普通、死亡、彈跳、移動等）
- ✅ 地圖配置保存為 `map_config.dat`

## 如何使用地圖編輯器

### 圖形化編輯器（推薦）：

#### 啟動方式：
```batch
# 方法1: 執行批次檔
啟動地圖編輯器.bat

# 方法2: 命令行
java --module-path "D:\Tools\javafx-sdk-17.0.17\lib" --add-modules javafx.controls MapEditorGUI
```

#### 操作方式：
1. **創建平台** - 按住滑鼠左鍵拖曳即可創建平台
2. **選擇平台** - 點擊滑鼠右鍵選擇平台
3. **刪除平台** - 選中平台後點擊「刪除選中平台」按鈕或按 Delete 鍵
4. **調整屬性** - 在右側面板選擇平台類型、寬度、高度、旋轉角度
5. **儲存地圖** - 點擊「💾 儲存地圖」按鈕
6. **載入地圖** - 點擊「📂 載入地圖」按鈕

#### 視覺提示：
- **綠色線** - 起點位置（左側）
- **金色線** - 終點位置（右側）
- **黃色邊框** - 選中的平台
- **網格** - 方便對齊平台
- **座標顯示** - 底部狀態欄顯示滑鼠座標

### 命令行編輯器：
```batch
java MapEditor
```

### 編輯器功能：
1. **新增平台** - 輸入座標、大小、類型等參數
2. **刪除平台** - 選擇平台編號進行刪除
3. **列出所有平台** - 查看當前地圖配置
4. **清空地圖** - 移除所有平台
5. **創建預設地圖** - 快速生成範例地圖
6. **儲存地圖** - 保存到 `map_config.dat`
7. **載入地圖** - 從文件載入配置

### 平台類型：
- **NORMAL** - 普通平台（棕色 #8B4513）
- **DEATH** - 死亡平台（紅色 #FF0000）- 可以站立但碰觸會失敗
- **BOUNCE** - 彈跳平台（綠色 #00FF00）
- **MOVING_H** - 水平移動平台（藍色 #00AAFF）
- **MOVING_V** - 垂直移動平台（紫色 #AA00FF）

### 座標範圍建議：
- **X 座標**: 0 ~ 4800（遊戲地圖寬度）
- **Y 座標**: 200 ~ 600（合適的高度範圍）
- **寬度**: 50 ~ 300
- **高度**: 15 ~ 50
- **旋轉**: 0, 90, 180, 270 度

## 啟動遊戲

### 1. 啟動伺服器：
```batch
java GameServer
```

### 2. 啟動客戶端：
```batch
java --module-path "D:\Tools\javafx-sdk-17.0.17\lib" -cp ".;fxgl-21.1-uber.jar" --add-modules javafx.controls,javafx.fxml --enable-native-access=javafx.graphics GameClient
```

## 遊戲流程

1. 伺服器啟動後，等待玩家連接
2. 玩家創建或加入房間
3. 房主點擊「開始遊戲」
4. **地圖平台會在遊戲開始時載入一次**
5. 每回合玩家選擇並放置物件
6. 競賽階段，玩家跑向終點
7. 重複 5-6 步驟直到遊戲結束

## 重要變更

### 地圖平台載入時機：
- ❌ 舊版：每回合都會生成新的隨機平台
- ✅ 新版：**只在遊戲開始時載入地圖配置一次**
- 載入的平台會保持整場遊戲，不會在回合之間改變

### 玩家放置的平台：
- 玩家每回合仍然可以選擇並放置自己的平台
- 玩家放置的平台會在該回合結束後保留
- 下一回合開始時，所有玩家放置的平台依然存在

## 編輯地圖範例

### 創建預設地圖：
1. 啟動 `java MapEditor`
2. 選擇 `5` 創建預設地圖
3. 選擇 `6` 儲存地圖
4. 選擇 `8` 退出

### 自訂地圖：
1. 啟動 `java MapEditor`
2. 選擇 `1` 新增平台
3. 依提示輸入參數（例如：X=1000, Y=350, 寬=200, 高=25, 類型=1）
4. 重複步驟 2-3 添加更多平台
5. 選擇 `3` 查看所有平台
6. 選擇 `6` 儲存
7. 選擇 `8` 退出

## 檔案說明

- `MapEditor.java` - 地圖編輯器主程式
- `MapConfig.java` - 地圖配置類
- `map_config.dat` - 地圖配置文件（二進制格式）
- `GameServer.java` - 遊戲伺服器
- `GameClient.java` - 遊戲客戶端
- `SharedMessages.java` - 共用訊息類別

## 故障排除

### 問題：地圖沒有載入
- 確認 `map_config.dat` 文件存在於遊戲目錄
- 使用地圖編輯器檢查配置是否正確
- 查看伺服器控制台是否有錯誤訊息

### 問題：平台位置不正確
- 使用地圖編輯器查看座標
- 調整 X, Y 座標到合適範圍
- 重新儲存並重啟遊戲

### 問題：ERASER 無法清除平台
- 確認 ERASER 範圍夠大（建議 150x150）
- 檢查是否在正確位置放置
- ERASER 只能清除玩家放置的平台，不會清除固定平台（起點、終點、地面）
